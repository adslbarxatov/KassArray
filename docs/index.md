# Инструмент сервис-инженера контрольно-кассовой техники KassArray: руководство пользователя
> **ƒ** &nbsp;RD AAOW FDL; 10.10.2025; 1:21

---

### Содержание страницы

- [Общие сведения об инструменте KassArray](#kassarray)
- [Общие сведения об инструменте KassArrayTB](#kassarraytb)
- [Быстрые руководства по распространённым операциям](https://adslbarxatov.github.io/KassArray/quick)
- [Ссылки для загрузки](https://adslbarxatov.github.io/DPArray/ru#kassarray)

---

- Модуль чтения и обработки данных ФН для KassArray

    1. [Общие сведения](#section-1)

    2. Начало работы

    2.1. [Подключение ФН и адаптера к ПК](#section-3)

    2.2. [Установка драйвера устройства](#section-4)

    3. [Работа с модулем](#section-5)

    3.1. [Функции, доступные при запуске](#section-7)

    - [Выбрать номер порта подключения ФН](#section-8)
    - [Начать чтение](#section-9)
    - [Контекстное меню поля статуса ФН](#section-10)
    - [Открыть файл архива ФН](#section-11)
    - [Найти архив или статус ФН](#section-12)
    - [Сформировать файл архива ФН](#section-13)
    - [Сформировать выгрузку уведомлений о реализации маркированных товаров](#section-14)
    - [Изменение уровня детализации считывания](#section-15)
    - [Отобразить статус ФН](#section-16)
    - [Общие настройки](#section-17)
    - [Руководство пользователя](#section-18)
    - [Горячие клавиши](#section-19)

    3.2. Функции, доступные после открытия порта, загрузки файла и в режиме прямого чтения

    - [Обмен с ОФД](#section-21)
    - [Прямое чтение документов из ФН](#section-22)
    - [Извлечь смену из ФН по дате](#section-23)
    - [Получение отчётов](#section-24)
    - [Сохранение считанных данных](#section-25)
    - [Запрос счётчиков ФН](#section-26)
    - [Интерактивные функции](#section-27)
    - [Запись в ФН](#section-28)
    - [Пакетное оформление документов](#section-29)
    - [Фискализация ФН](#section-30)

---

&nbsp;

## Общие сведения об инструменте KassArray

Инструмент позволяет:
- просматривать и сохранять / отправлять на печать ***инструкции по работе с ККТ***;
- просматривать расшифровки ***кодов ошибок ККТ***;
- определять ***срок жизни ФН*** в соответствии параметрами пользователя, от которых он зависит;
- определять ***корректность регистрационного номера ККТ*** и ***генерировать его*** при необходимости;
- определять ***соответствие моделей ККТ версиям ФФД***;
- получать ***настройки операторов фискальных данных*** (ОФД) по их ИНН или названиям;
- получать ***описания и признаки обязательности TLV-тегов*** для различных ФФД (cписок поддерживаемых TLV-тегов можно посмотреть [здесь](https://github.com/adslbarxatov/KassArray/blob/main/src/FNReader/FNEnums.h));
- просматривать определения для ***часто используемых терминов и аббревиатур***;
- вручную (без использования внешней клавиатуры) ***программировать текстовые данные в ККТ***, имеющих только цифровую клавиатуру;
- автоматически ***определять модели ККТ и фискальных накопителей*** (ФН) по их заводским номерам, а также регионы РФ по кодам ИНН;
- просматривать ***распиновки кабелей*** ККТ – ПК, ККТ – ДЯ и ККТ – Принтер;
- определять ***типы штрих-кодов*** и разбирать их содержимое (включая DataMatrix маркируемых товаров);
- находить ***команды нижнего уровня*** для протоколов Атол, Эвотор и Штрих;
- дополнительно: получать разложения и представления чисел в системах счисления с основаниями 2, 10 и 16;
- дополнительно: преобразовывать коды Unicode в символам и наоборот;
- дополнительно: преобразовывать двоичные данные в текст и обратно.

Windows-версия инструмента также может быть добавлена в автозапуск при установке. В этом случае при запуске системы она остаётся свёрнутой
в значок в трее. По нажатию на этот значок она может быть повторно вызвана или свёрнута обратно.

Для приложения доступны функции «Поверх всех окон» (Windows) и «Режим сервис-инженера» (все версии). Последний переводит приложение
в режим полной функциональности и открывает опции, которые не должны быть доступны оператору или кассиру
(например, команды нижнего уровня или работу с ФН). Соответствующие флажки доступны на последней вкладке.

---

&nbsp;

## Общие сведения об инструменте KassArrayTB
> только Windows

Данный инструмент позволяет формировать бумажные заявления для регистрации и перерегистрации ККТ,
а также снятия ККТ с учёта в ФНС в офлайн-режиме (при отсутствии ЭЦП). Интерфейс не должен вызвать
сложностей у пользователей, имеющих опыт регистрационных действий в ЛК ФНС. Однако в его работе
имеются некоторые особенности:
- Любое поле можно оставить незаполненным. В этом случае в печатной версии заявления оно останется
пустым, и его можно будет заполнить от руки.
- Некоторые поля (например, ИНН или ФПД) в случае заполнения контролируются на корректность значений.
При возникновении ошибок печать документа прерывается, а пользователь извещается о проблеме.
Контроль не будет выполняться, если эти поля оставить пустыми.
- При вводе заводских номеров ККТ и ФН приложение предпримет попытку автоматически подставить
их наименования. Однако не все модели на данный момент присутствуют в базе знаний KassArray.
Поэтому название всегда можно выбрать вручную из списка или оставить пустым и заполнить от руки.
- Настройки «Тип заявления» и «Работа с ОФД», а также все флажки влияют на заполнение полей типа
«да/нет», даже если Вы отправляете на печать полностью пустой бланк. Поэтому эти опции всё равно
необходимо указать правильно.
- При указании в полях ввода даты и времени 2017-го (минимально возможного) года их значение
игнорируется, и в печатной версии поля даты и времени остаются пустыми.

Поля, помеченные синим цветом, могут быть ***получены из ФН***. Для этого рекомендуется:
- Прочитать статус старого ФН, если выполняется замена или снятие с учёта.
- Запросить последний документ архива в режиме прямого чтения.
- Прочитать статус нового ФН, если выполняется замена, первичная регистрация или перерегистрация по любой причине.
- Запросить документ регистрации или перерегистрации в режиме прямого чтения.

Любой из этих шагов может быть пропущен (*мы предполагаем, что последние два шага, скорее всего,
в принципе в нормальных условиях применяться не будут*). В этом случае будут запрошены только
те данные, которые относятся к регистрационному номеру из последнего запрошенного статуса ФН.
Однако при любом результате запроса ***перед печатью следует внимательно проверить все параметры заявления
и самостоятельно заполнить недостающие поля, а также поля, которые не могут быть получены из ФН***.

Поля адреса при запросе данных из ФН при нажатии мышью будут вызывать контекстное меню со списком
элементов адреса последней регистрации ККТ, позволяя быстро их подставить при нажатии. Заполнение
города или населённого пункта также позволяет использовать функцию «Найти почтовый индекс»,
если он отсутствует в данных ФН.

---

&nbsp;

## Модуль чтения и обработки данных ФН для KassArray
> только Windows

## 1. Общие сведения

Модуль предназначен для чтения и обработки фискальных данных (ФД) из фискального накопителя (ФН).
Далее представлено полное описание функционала приложения. Быстрые руководства по распространённым
операциям Вы можете найти на [отдельной странице](https://adslbarxatov.github.io/KassArray/quick).

&nbsp;



Доступные функции:

1. ***Чтение данных из ФН*** с помощью физического или виртуального COM-порта и аппаратного адаптера.

2. ***Формирование выгрузок архивов ФН в формате*** `.fnc` в соответствии с [Приложением №2](https://nalog.gov.ru/rn77/about_fts/docs/10020801) к приказу
ФНС России «Форматы фискальных документов, обязательные к использованию» для версий ФФД `1.05` и `1.2`. Выгрузка в ФФД `1.1`
также реализована, но находится в тестировании и может работать некорректно.

3. ***Обработка фискальных данных***:
    - Получение полного состояния и всех регистрационных данных ФН;
    - Получение отдельного документа ФН;
    - Получение контрольной ленты за отдельную смену;
    - Получение полного фискального (посменного) отчёта;
    - Получение посменного отчёта по диапазону дат;
    - Получение полного помесячного отчёта;
    - Восстановление печатной формы чеков, БСО и чеков коррекции по реквизитам;
    - Прямой запрос счётчиков ФН (для ФФД `1.1` и выше);
    - Расчёт гросс-итогов по данным фискальных документов (для файлов и ФФД `1.05`);
    - Прямое чтение документов за определённую дату и расчёт сменных итогов.

4. ***Сохранение архива ФН в файл*** в форматах:
    - Двоичных данных (`.fsd`). Это внутренний формат программы, который не может быть использован
при перерегистрации или снятии ККТ с учёта в личном кабинете ФНС. Однако он доступен для последующего открытия и статистической обработки в программе.
    - Табличных данных (`.csv`, доступен для обработки в Microsoft Office Excel).

5. ***Выполнение обмена с ОФД*** с параметрами подключения, получаемыми автоматически по данным последней
регистрации / перерегистрации, или с параметрами, соответствующими выбранному ОФД. Обмен включает:
    - Передачу фискальных документов;
    - Передачу уведомлений о реализации маркированного товара;
    - Обновление ключей проверки кодов маркировки.

6. ***Выполнение операций записи в ФН***:
    - Открытие смены;
    - Закрытие смены;
    - Закрытие архива ФН;
    - Пакетная запись чеков, БСО и чеков коррекции в ФН;
    - Фискализация ФН;
    - Сброс МГМ (для технических целей).

Первые три задачи могут быть выполнены с применением текущей даты или даты последнего документа ФН (для ФН с истекшим сроком КС).

7. ***Чтение и статистическая обработка выгрузок архивов ФН*** в форматах `.fnc` и `.fsd`.

8. ***Формирование выгрузки уведомлений о реализации маркированного товара*** (при работе в автономном режиме)
в формате `.fnm` в соответствии с Приложением 2 к приказу
ФНС России «Форматы фискальных документов, обязательные к использованию» для версии ФФД `1.2` (***находится в тестировании***).

9. ***Кэширование имеющихся файлов*** `.fnc` и быстрый доступ к любому из них с помощью поиска по ИНН, заводским номерам,
РНМ или наименованиям пользователей.


Чтение может быть выполнено четырьмя способами:
- ***Полное чтение архива***. По его завершении становятся доступными все функции обработки данных.
- ***Прямое чтение ФН***. В этом случае доступны только функции чтения статуса ФН и содержимого отдельного документа.
- ***Формирование выгрузки .fnc с последующей её загрузкой***. Работает аналогично первому варианту, но набор
реквизитов документов будет неполным, т.к. в файлах выгрузок они хранятся в ограниченном составе.
- ***Прямое чтение документов из ФН за указанную дату***. Данный способ позволяет сформировать сменные
итоги без полного считывания ФН. Аналитика при этом останется недоступной.

Независимо от варианта и настроек чтения состояние ФН запрашивается в максимально полном виде. Количество видимых регистраций
и перерегистраций может быть ограничено последней (актуальной), если выбрана соответствующая опция.


Детализация чтения может быть:
- ***Полной***. При этом из ФН считываются все TLV-теги (в том числе – неизвестные приложению с представлением
в шестнадцатеричной форме) и квитанции подтверждения ОФД. Может занимать продолжительное время.
- ***Неполной***. Из ФН считываются только известные приложению TLV-теги. По скорости не отличается от предыдущего варианта.
- ***Краткой***. При этом считываются только суммовые счётчики, временны́е метки, номера, фискальные признаки
документов и состояния отправки ОФД. Выполняется быстрее полного считывания примерно в два раза.

Работа программы протестирована на всех моделях ФН из [реестра ФНС](https://nalog.gov.ru/rn77/related_activities/registries/reestr_fiscal).
При соблюдении производителями существующего аппаратного протокола чтения данных работа с будущими моделями ФН также будет возможна.
Однако выгрузка в формате `.fnc` требует дополнительных исследований, в связи с чем модуль может не поддерживать эту функцию
для новейших моделей ФН и новых серий ЗН существующих моделей.


Для выполнения операций с ФН требуется наличие одного из следующих аппаратных адаптеров:
- COM-UART переходник для подключения ФН к разъёму COM (RS-232) компьютера.
- USB-VCOM-UART переходник для подключения к разъёму USB компьютера. В этом случае потребуется установить драйвера устройства;
инструкции и ссылки для их установки предоставляются производителями таких переходников.

#

## 2. Начало работы (на примере VCOM-адаптера ООО «РИК»)

### 2.1. Подключение ФН и адаптера к ПК

Перед началом работы необходимо подготовить адаптер к работе. Порядок подключения следующий:
- Убедиться, что адаптер не подключён к ПК или другому источнику питания.
> ***Подключение и отключение ФН при наличии питания на адаптере запрещено! Это может вывести оба устройства из строя!***
- Подключить ФН к адаптеру. Обратите внимание на расположение «ключа» (пропущенного контактного штырька) на разъёмах ФН и адаптера.

<img src="/KassArray/img/01.png" />

- Подключить адаптер к ПК.

Отключение по окончании работы с адаптером следует производить в обратном порядке:
- Отключить адаптер от ПК.
- Отключить ФН от адаптера.

> ***Отключение или переподключение адаптера при обращении к нему программы (определяется горящим или мигающим светодиодом
> на адаптере) запрещено! Это может вывести адаптер и ФН из строя!***

Кроме того, при использовании USB-подключения для корректной и стабильной работы рекомендуются короткие соединительные
кабели (не длиннее 20 см) с общим сечением не менее 2,5 мм. Более длинные и / или тонкие кабели могут не обеспечивать
достаточную силу тока для некоторых моделей ФН (проверено на некоторых интерфейсных кабелях, не предназначенных
для зарядки аккумуляторов).

### 2.2. Установка драйвера устройства

После первого подключения адаптера к ПК может потребоваться установка драйвера. Драйвер для устройств FTDI VCP
доступен [здесь](http://ftdichip.com/Drivers/VCP.htm). Если драйвер упакован в архив, следует выполнить его распаковку в какую-либо папку.

Далее рассматривается установка драйвера на примере устройства FT230X Basic UART. Для установки драйвера необходимо выполнить следующие действия:
- В меню «Пуск» выбрать пункт «Выполнить» или нажать комбинацию клавиш [Win] + [R].
- Ввести команду `compmgmt.msc` и нажать кнопку «ОК».
- В окне «Управление компьютером» в списке слева выбрать пункт «Диспетчер устройств». В списке устройств найти устройство «FT230X Basic UART»
(будет помечено значком ошибки).

<img src="/KassArray/img/02.png" />

- Щёлкнуть правой кнопкой мыши на этом устройстве и выбрать пункт «Обновить драйверы». В окне варианта установки выбрать «Выполнить поиск
драйверов на этом компьютере». В следующем окне нажать кнопку «Обзор» и указать папку, куда ранее были распакованы драйвера. Нажать кнопку «Далее».
- При необходимости проделать аналогичные манипуляции с устройством «USB Serial Converter» (если оно будет помечено значком ошибки).
- Найти в списке устройств раздел «Порты COM и LPT», а в нём – устройство «USB Serial Port». Запомнить номер порта; он потребуется для работы программы.

#

## 3. Работа с модулем

В комплектацию модуля входят три файла – `KassArrayFN.exe`, `KassArrayDB.dll` и `KassArrayLL.dll`. Отсутствие любого из них делает работу
модуля невозможной. Запускать следует файл `KassArrayFN.exe` или файл `KassArray.exe`, из которого следует вызывать функцию «Работа с ФН».

Основной интерфейс модуля представлен на рисунке ниже.

<img src="/KassArray/img/03.png" />

---

### 3.1. Функции, доступные при запуске

Управляющие кнопки в модуле разведены по функциональным вкладкам. Далее их названия будут указаны под заголовками.

#### Выбрать номер порта подключения ФН
> Вкладка «Физический ФН»

Здесь необходимо выбрать порт, который соответствует устройству, появившемуся в системе при установке драйверов
(см. пункт 2.2 данного руководства). Если подключение устройства выполнено после запуска приложения, можно обновить список системных портов
кнопкой «***Обновить список портов***».

---

#### Начать чтение
> Вкладка «Физический ФН»

Запрашивает статус ФН и, если выбран способ чтения «***чтение всех регистраций и всех документов***», запускает процесс
считывания данных из ФН. При этом будет отображено окно состояния чтения. На время считывания основное окно программы блокируется.
Если было выполнено полное считывание, по его завершении откроется доступ к аналитическим функциям программы.

<img src="/KassArray/img/04.png" />

Если процесс был прерван, или был выбран иной вариант чтения, аналитика будет недоступна. В обоих случаях станут
активными функции обмена с ОФД, прямого чтения и записи в ФН. Кроме того, модуль позволяет запрашивать (на выбор)
все или только последнюю регистрацию из ФН (тот же выпадающий список вариантов чтения).

---

#### Контекстное меню поля статуса ФН
> Поле статуса ФН в главном окне

При нажатии правой кнопкой мыши в текстовом поле главного окна, в котором отображается статус ФН, открывается контекстное меню.
Оно позволяет:
- копировать выбранный текст в буфер обмена
- копировать весь текст
- сохранять весь текст поля в файл
- отправлять содержимое поля на печать
- очистить текстовое поле статуса

Кроме того, в зависимости от того, какой документ в данный момент отображается, меню позволяет найти и скопировать некоторые
реквизиты документа: РНМ, ЗН ККТ, ЗН ФН, ИНН пользователя, номер ФД и другие. Наконец, при выборе четырёхзначного номера
TLV-тега, который не смог расшифровать модуль, можно запросить его описание согласно ФФД.

---

#### Открыть файл архива ФН
> Вкладка «Работа с файлами»

Открывает ранее сохранённый файл выгрузки ФН и позволяет выполнять с ним те же манипуляции, что и со считанными
данными, открывая аналитический функционал. Функция поддерживает два формата файлов:
- Собственный формат файла (`.fsd`);
- Эталонный формат архива, создаваемый этой программой, а также программами FNArc, FNRun и FNTransfer (`.fnc`). ***На данный
  момент с выгрузками в ФФД*** `1.1` ***проводится тестирование; функционал может быть неполным***.

Эта функция доступна также в варианте *Открыть с помощью*: при первом запуске приложение автоматически сопоставляет
указанные выше форматы файлов.

---

#### Найти архив или статус ФН
> Вкладка «Работа с файлами»

Открывает отдельное окно управления базой считанных архивов ФН (файлов `.fnc`). Данный интерфейс позволяет:
- Кэшировать директории с файлами `.fnc`, извлекая из них краткие сведения: ИНН, ЗН ККТ, ЗН ФН, РНМ,
наименование пользователя, адрес и место расчёта, а также диапазон дат архива.
- Находить среди кэшированных файлов нужный по ИНН, ЗН, РНМ или фрагменту наименования пользователя.

<img src="/KassArray/img/05.png" />

Нажатие кнопки «Открыть найденный файл» передаёт путь к нему в основной интерфейс, после чего его обработка
выполняется в соответствии с функциями приложения.

В настройках приложения также можно активировать опцию кэширования статусов ФН. Это означает,
что каждый считанный статус будет сохраняться в директории приложения, и его точно так же можно будет обнаружить
путём поиска в этом разделе. Данная функция использует заводской номер ФН в качестве уникального идентификатора,
что позволяет избегать задвоений. При повторном считывании ФН предыдущий считанный статус заменяется новым.

---

#### Сформировать файл архива ФН
> Вкладка «Выгрузка архивов»

Запускает процесс выгрузки архива ФН в формат `.fnc`, пригодный для передачи в ЛК ФНС при замене ФН, зарегистрированных в автономном режиме.
Эту же функцию можно задействовать, когда требуется получить доступ к аналитике для ФН с большим количеством документов.
При успешном завершении процесса программа откроет этот файл для обработки автоматически.

---

#### Сформировать выгрузку уведомлений о реализации маркированных товаров
> Вкладка «Выгрузка архивов»

Запускает процесс выгрузки уведомлений в формат `.fnm`, пригодный для передачи в систему «Честный знак», для ФН,
зарегистрированных в автономном режиме с ФФД `1.2` и признаком торговли маркированными товарами (`ТМТ`).

> ***Функционал находится в тестировании***. Поэтому приложение будет выполнять *подтверждение выгрузки* –
> необратимую часть процедуры, – только если пользователь согласится на продолжение. Это позволит
> проверить создаваемые файлы на корректность (при отправке в «Честный знак»).
> Кроме того, создание выгрузки согласно всем правилам по каким-то причинам делает их отличающимися
> и от выгрузок приложения WIN_TEST_FM_1_2 (не совпадает поле CRC при соответствии всех остальных данных),
> и от выгрузок программы FNArc_1_2 (отличается поле «номер последнего уведомления» в заголовке).
> Поэтому проверка выгрузки перед *подтверждением* на текущий момент ***строго обязательна***!

---

#### Изменение уровня детализации считывания
> Вкладка «Физический ФН»

Переключатель детализации позволяет указать, будет ли выполняться считывание:
- Только основных данных;
- Основных и распознаваемых приложением текстовых данных, а также подтверждений от ОФД и фискальных признаков сообщений;
- Всех доступных тегов, в том числе – неизвестных модулю. Неизвестные теги отображаются без расшифровки в шестнадцатеричной форме.

Включение детализации замедляет полный процесс чтения примерно в два раза, но позволяет просмотреть, например,
наименования товаров и услуг или реквизиты покупателя. Обращаем внимание, что выбранный вариант определяет
поведение и функции считывания ФН, и функции прямого доступа к нему.

---

#### Отобразить статус ФН
> Вкладка «Прочее»

Возвращает ранее запрошенный статус ФН в окно статуса приложения. Для этой функции также доступны сохранение в файл
и отправка на принтер.

---

#### Общие настройки
> Вкладка «Прочее»

Управляемые настройки модуля вынесены в отдельный интерфейс. Здесь можно:
- *Указать формат отправки на печать для всех отчётов*, формируемых модулем. В качестве
носителя может выступать бумага A4, а также чековая лента шириной 80 мм и 57 мм. При этом используются обычный офисный и чековый принтеры,
соответственно. Кроме того, для чековой ленты доступны обычное и полужирное начертание шрифта (для компенсации яркости печати).
- Если приложение ранее выполняло печать с текущими настройками, выбранный при этом принтер можно зафиксировать.
В этом случае при следующей отправке документов на принтер выбор устройства будет пропущен, и задание будет создано с этими же параметрами.
- *Указать путь для сохранения выгрузок* `.fnc` *и* `.fnm`. По умолчанию выгрузки формируются на рабочем столе текущего пользователя.
- *Указать таймаут для команд, направляемых ФН*. Если при чтении ФН наблюдаются потери реквизитов или обрывы связи, рекомендуется увеличить
это значение для обеспечения необходимой оборудованию задержки между командами ФН. Для ускорения выгрузок данных можно временно уменьшить
задержку, чтобы попытаться найти баланс между скоростью и отказоустойчивостью для текущей конфигурации ПК.
- Указать, следует ли добавлять к сохраняемым и печатаемым документам и отчётам полный текстовый статус ФН.
- Указать, следует ли добавлять в отчёты нулевые счётчики ФН.
- Задать параметры отслеживания и отправки на печать печатных форм чеков (для технических целей).

<img src="/KassArray/img/06.png" />

---

#### Руководство пользователя
> Вкладка «Прочее»

Открывает данное руководство в браузере по умолчанию.

---

#### Отобразить горячие клавиши
> Вкладка «Прочее»

Отображает в поле статуса краткую справку по горячим клавишам приложения. Модуль поддерживает набор удобных клавиатурных сокращений
для наиболее часто используемых функций:
- `Ctrl` + `O`: открыть COM-порт и подключить ФН.
- `Shift` + `O`: открыть файл архива ФН.
- `Ctrl` + `B`: найти файл архива ФН в базе.
- `Ctrl` + `D`: сформировать выгрузку архива ФН.
- `Ctrl` + `M`: сформировать выгрузку уведомлений о реализации маркированного товара.
- `Ctrl` + `S`: сохранить считанные данные ФН в другом формате.
- `Ctrl` + `I`: запустить автоматический обмен с ОФД.
- `Shift` + `S`: отобразить статус ФН.
- `Shift` + `C`: запросить счётчики ФН.
- `Ctrl` + `F`: сохранить содержимое поля статуса в файл *с добавлением статуса ФН*.
- `Shift` + `F`: сохранить содержимое поля статуса в файл *без добавления статуса ФН*.
- `Ctrl` + `P`: отправить содержимое поля статуса на принтер *с добавлением статуса ФН*.
- `Shift` + `P`: отправить содержимое поля статуса на принтер *без добавления статуса ФН*.
- `Ctrl` + `C`: скопировать выделенную часть статуса или текст целиком (если текст не выделен).
- `Ctrl` + `T`: запросить описание выделенного тега.
- `Ctrl` + `K`: вызвать настройки приложения.
- `Ctrl` + `H`: запросить данное описание горячих клавиш.

---

### 3.2. Функции, доступные после открытия порта, загрузки файла и в режиме прямого чтения

---

#### Обмен с ОФД
> Вкладка «Обмен с ОФД»

Запускает отправку документов из ФН оператору фискальных данных, если очередь отправки не пуста. Настройки подключения определяются автоматически
(при выборе ***автоматического обмена***). На данный момент для всех ОФД из реестра ФНС имеется однозначное соответствие ИНН / Названия ОФД и параметров Host
name / IP + TCP port, которое позволяет избавить пользователя от необходимости ручной настройки соединения. Программе известны настройки связи
со всеми ОФД, действующими на *1 сентября 2025 года*.

Тем не менее, выбор ***ручного обмена*** позволяет указать любой неаннулированный ОФД вручную. Это удобно в случаях, когда пользователь хочет
сменить ОФД (уже перестал его оплачивать), а в ФН ещё остались непереданные документы, мешающие сделать перерегистрацию. *ОФД обычно принимают
документы, не обращая внимания на несовпадение ИНН ОФД в параметрах регистрации*.

В этой же вкладке случае доступен также флажок «***Восстанавливать связь при обрыве***». Если он активен, отправка документов будет циклически
перезапускаться, пока не будет отменена вручную (даже в случае отсутствия выхода в интернет или истечения тарифа ОФД).

При запуске обмена из ФН запрашивается длина очереди отправки и ИНН ОФД, после чего выполняется попытка подключения и передачи. В случае ошибки
модуль сообщает, на каком шаге она происходит. А именно – была ли проблема в подключении, или подключение есть, но ОФД не принимает документ из-за
истечения тарифа. Если связь устанавливается, программа последовательно отправляет все документы из очереди. При необходимости этот процесс можно
прервать. По окончании передачи состояние ФН автоматически перезапрашивается.

Для ФН, зарегистрированных с ФФД `1.2` и признаком торговли маркированными товарами, также выполняется опрос очереди и отправка
уведомлений о реализации маркированных товаров, а также обновление ключей проверки кодов маркировки. Для ФН, не содержащих
адреса обновления ключей, выполняется подстановка адреса по умолчанию. Если шаг обновления ключей требует повтора, пользователь извещается об этом.

---

#### Прямое чтение документов из ФН
> Вкладка «Чтение ФД из ФН»

Флажок «***Включить***» установлен, когда программа находится в режиме прямого чтения данных.
В этом режиме доступны только функции чтения статуса ФН, а также извлечения отдельного документа.

Обращаем внимание, что переход из этой вкладки на любую другую автоматически отключает
режим прямого чтения во избежание последующих избыточных действий.

Нажатие клавиши `Enter` в поле номера документа для прямого чтения или кнопок «***Запросить***», «***Первый***» и «***Последний***» запускает запрос
документа. В случае двух последних кнопок поле номера документа получает соответствующее значение.

---

#### Извлечение смены из ФН по дате
> Вкладка «Чтение смены из ФН»

Данная функция позволяет извлечь данные за указанную дату из ФН без его полного считывания (без запуска аналитики).
При этом определяются границы смены, и выполняется расчёт её итогов, которые затем можно сохранить или распечатать.
Здесь возможен выбор формата отчёта: только итоговые суммы или полная контрольная лента.

Если по указанной дате обнаруживается несколько смен, отображаются все затронутые смены. Если открытие или закрытие
смены выполнено другой датой, модуль выполнит дочитывание документов до полной смены.

---

#### Получение отчётов
> Вкладка «Сводные отчёты»

После полного считывания или в результате загрузки файла архива ФН становятся доступны функции:
- отдельный документ по номеру;
- контрольная лента за смену по номеру;
- сменные итоги по диапазону дат;
- итоги всех смен из ФН
- итоги всех смен помесячно.

---

#### Сохранение считанных данных
> Вкладка «Выгрузка архивов»

Эта опция позволяет преобразовать считанные данные или открытые файлы в один из следующих форматов
(выбирается в окне сохранения файла):
- Табличный файл `.csv`, доступный для обработки в Microsoft Office Excel и аналогичных программах.
- Бинарный файл `.fsd`, с которым возможна последующая работа в программе.

В этом случае программа предложит в качестве имени файла комбинацию из заводского номера ФН,
заводского номера ККТ и наименования владельца ККТ.

---

#### Запрос счётчиков ФН
> Вкладка «Чтение смены из ФН»

Если ФН был фискализирован с ФФД `1.1` или выше, эта функция позволяет напрямую запросить счётчики накоплений из ФН.
В противном случае опция будет доступна только при полном считывании данных или работе с файлом архива ФН.
Если приложению окажутся доступны оба варианта, пользователь сможет выбрать, каким из них следует воспользоваться.

---

#### Интерактивные функции
> Вкладка «Сводные отчёты»

Эти функции предполагают отображение сведений в поле статуса окна приложения при выполнении следующих действий:
- При выборе отчёта «*Документ из ФН*» и установке курсора или изменении значения в поле номера документа будет отображено
содержимое соответствующего документа;
- При выборе отчёта «*Контрольная лента за смену*» и установке курсора или изменении значения в поле номера смены будут
отображены итоги соответствующей смены.

---

#### Запись в ФН
> Вкладка «Запись в ФН»

Флажок «***Разрешить***» активирует режим, предполагающий запись данных в ФН. В нём доступны:
- Сброс МГМ
- Открытие и закрытие смены
- Закрытие архива
- Пакетное проведение документов
- Регистрация и перерегистрация ФН

Эти функции могут быть удобны, если по какой-либо причине закрытие
смены или архива в ККТ невозможно (например, исчерпание ресурса ФН при открытой смене). Эти функции позволяют, например,
снять с учёта ФН с истекшими тарифами ОФД и регистрациями ФНС или исправить множественные ошибки или факты неприменения
ККТ. Переключатель применения даты последнего документа ФН вместо текущей позволяет снять необходимость в её ручном поиске
по документам.

> ***Если Вы не знаете, зачем нужны эти функции, использовать их и включать этот режим запрещено. Их применение требует
> внимания, т.к. результаты их работы необратимы. Все перечисленные функции выполняются пользователем на свой страх и риск!***

При успешном завершении этих операций программа автоматически предпринимает попытку отправить вновь появившиеся
документы ОФД, после чего предлагает перейти в режим прямого чтения для запроса последнего документа (с целью последующего
сохранения или печати). Особенности работы с пакетным оформлением описаны в следующем разделе.

---

#### Пакетное проведение документов
> Вкладка «Запись в ФН»

Эта функция позволяет записывать большое количество чеков, БСО и чеков коррекции в фискальный накопитель,
используя табличный шаблон. Опция помогает исключить человеческий фактор, связанный с возможными ошибками
при ручном вводе фискальных данных в ККТ, а также значительно ускоряет весь процесс. Реализована на случай
необходимости исправления множественных ошибок или фактов неприменения ККТ.

Пакетное оформление находится в разделе «Запись в ФН» в списке режимов записи. Запустить его можно только
при успешном подключении к зарегистрированному ФН с незакрытым архивом. При этом смена должна быть открыта (можно сделать здесь же).

> :warning: Обращаем внимание, что данная функция является новой для приложения. И мы, несмотря на длительную
> отладку и сверку реквизитов с ОФД, пока не можем гарантировать, что она будет работать ожидаемым образом.
> ***Настоятельно рекомендуем сначала выполнить все действия, предлагаемые этой опцией, на МГМ, прежде чем
> использовать боевой ФН***.
>
> :warning: Помните, что все действия здесь Вы выполняете на свой страх и риск! Любая ошибка в реквизитах
> документов является исключительно Вашей ответственностью!

На первом шаге приложение предложит Вам сохранить *образец шаблона*, содержащий подробные комментарии
и формат таблицы, совместимый с текущей версией приложения. Вы можете изменить его требуемым образом
с помощью программы Microsoft Office Excel (или аналогичного табличного процессора с поддержкой формата
`XLSX`). Далее его потребуется сохранить в формате «`CSV – разделители-запятые`», после чего его уже можно
будет использовать в приложении.

> Если при последующей загрузке файла `CSV` у Вас возникнут проблемы, убедитесь, что в сохранённом файле
> разделителем столбцов является символ `;` (точка с запятой), а не табуляция или запятая. Последнее, скорее
> всего, может означать, что Ваш табличный процессор не поддерживает русскую локализацию

Программа выполняет полный контроль всех полей таблицы. В текущей версии она представлена следующими столбцами:
- `Столбец A` – тип документа. Одно из восьми значений: четыре для чеков / БСО (приход / возврат / расход / возврат)
  и четыре – для чеков коррекции. Если поле пустое или содержит что-то другое, вся строка будет проигнорирована
  (кроме описаний предметов расчёта – см. далее). Чеки коррекции возврата будут недоступны для `ФФД 1.05`.
- `Столбец B` – дата и время. Приложение не допускает превышения текущей даты ПК более чем на сутки, а также требует,
  чтобы дата на каждой следующей строке превосходила или была равна предыдущей.
- `Столбцы C и D` – реквизиты кассира. Должны содержать непустое ФИО и корректный ИНН.
- `Столбцы E – I` – суммы по способам оплаты. Если указано только одно значение, но оно будет неправильным,
  приложение автоматически заменит его рассчитанной суммой по предметам расчёта. Если способов оплаты несколько,
  потребуется самостоятельно убедиться в точном соответствии суммы по всем способам оплаты сумме по всем предметам
  расчёта.
- `Столбец J` – система налогообложения. Одно из пяти значений, описанных в шаблоне.
- `Столбец K` – количество предметов расчёта (товаров, услуг и т.п.). Указывает, сколько строк, включая текущую,
  будет использовано в качестве описаний предметов расчёта. Начиная со второй строки набора описаний, программа
  учитывает только столбцы `L – R`, поэтому их можно не заполнять.
- `Столбцы L – N` – наименования, цены и количества предметов расчёта. Не могут быть пустыми и / или нулевыми.
- `Столбцы O, P и R` – предмет расчёта, способ расчёта и ставка НДС. Определяются списком значений тегов `1212`,
  `1214` и `1199`, соответственно.
- `Столбец Q` – единица измерения. Для любого ФФД определяется списком значений тега `2108`. Но для ФФД ниже `1.2`
  при записи чека в ФН она автоматически подменяется текстовым представлением единицы измерения и указывается
  в виде тега `1197` (рекомендация ФНС).
- `Столбец S` – дополнительный реквизит. Заполняется только по рекомендации ФНС. В остальных случаях следует
  оставить пустым.
- `Столбцы T и U` – реквизиты чека коррекции. Используются только в соответствующих типах документов. Если
  основание коррекции пусто, режим коррекции автоматически устанавливается в значение «самостоятельно».

Результат контроля собирается программой в журнал. При обнаружении хотя бы одной непреодолимой проблемы вся процедура
будет отменена, и будет открыт журнал ошибок. Если ошибок нет, или имеются только предупреждения, пользователь
может запустить внесение документов в ФН.

По завершении приложение сообщит об успехе операции или об ошибке, которая не позволяет её продолжить,
а также предложит отправить документы ОФД. В случае, если в шаблоне были документы, дата которых ещё не наступила,
мы рекомендуем отложить отправку до момента их «актуализации»

---

#### Фискализация ФН
> Вкладка «Запись в ФН»

Эта функция позволяет формировать отчёты о регистрации и перерегистрации в ФН.

Фискализация ФН находится в разделе «Запись в ФН» в списке режимов записи. Запустить его можно только
при успешном подключении к ФН с незакрытым архивом. При этом смена должна быть закрыта (можно сделать здесь же).

> :warning: Обращаем внимание, что данная функция является новой для приложения. И мы, несмотря на длительную
> отладку и сверку реквизитов с ОФД, пока не можем гарантировать, что она будет работать ожидаемым образом.
> ***Настоятельно рекомендуем сначала выполнить все действия, предлагаемые этой опцией, на МГМ, прежде чем
> использовать боевой ФН***.
>
> :warning: Помните, что все действия здесь Вы выполняете на свой страх и риск! Любая ошибка в реквизитах
> документов является исключительно Вашей ответственностью!

На первом шаге приложение предложит Вам сохранить *образец шаблона*, содержащий подробные комментарии
и формат полей, совместимый с текущей версией приложения. Вы можете изменить его требуемым образом
с помощью программы Microsoft Office Word, Wordpad или аналогичного текстового процессора с поддержкой формата
`RTF`. Далее его потребуется сохранить в том же формате, после чего его уже можно будет использовать в приложении.

Обращаем внимание, что при сохранении файла шаблона для фискализированного ФН приложение подставляет лишь часть
реквизитов регистрации (адрес, место, наименование, РНМ, ЗН ККТ, ИНН и некоторые другие, а также часть флагов).
Остальные параметры не всегда возможно извлечь из ФН. ***Поэтому, независимо от успешности запроса статуса, всегда
самостоятельно проверяйте корректность всех реквизитов, включая те, которые не меняются при перерегистрации***.

Результат контроля всех реквизитов собирается программой в журнал. При обнаружении хотя бы одной непреодолимой
проблемы процедура будет отменена, и будет открыт журнал ошибок. Если ошибок нет, или имеются только предупреждения,
пользователь может запустить запись в ФН.

По завершении приложение сообщит об успехе операции или об ошибке, которая не позволяет её продолжить,
а также предложит отправить сформированный документ ОФД, а также сохранить его или отправить на печать.
