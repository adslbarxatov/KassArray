# Короткие инструкции для распространённых операций

---

Все нижеприведённые операции предполагают, что:
- ФН подключён к ПК с помощью переходника и готов к работе;
- Приложение **KassArrayFN** запущено.

Если это не так, рекомендуем вернуться к [основному руководству](https://adslbarxatov.github.io/KassArray).

&nbsp;



На этой странице описаны:

- [Начальные действия, общие для всех операций](#section-1)
- [Закрытие архива ФН](#section-2)
- [Запрос документа из памяти ФН](#section-3)
- [Запрос итогов смены из памяти ФН](#section-4)


&nbsp;

---

## Начальные действия, общие для всех операций

1. На вкладке **`Физический ФН`** выберите COM-порт, к которому подключён ФН.
    - Если нужный порт появился в системе после запуска приложения, воспользуйтесь кнопкой `Обновить список портов`.

2. Нажмите кнопку `Начать чтение`. Будет запрошен и отображён полный статус накопителя.
    - При необходимости статус ФН может быть сохранён в файл или отправлен на печать с помощью контекстного меню поля статуса.

---



## Закрытие архива ФН

1. На вкладке **`Запись в ФН`** нажмите кнопку `Разрешить`. В предупреждении нажмите кнопку `OK`.

2. Если срок действия ФН истёк, рекомендуется выбрать вариант *`Использовать дату последнего документа ФН`*. Иначе можно
не менять этот параметр.

3. Выберите действие *`Закрыть архив ФН`* и нажмите кнопку `Выполнить`. Внимательно прочтите предупреждения и подтвердите операцию.
    - Если приложение сообщает об открытой смене, вы можете выполнить закрытие здесь же, выбрав действие *`Закрытие смены`*.
    - Если в ФН имеются непереданные документы, приложение сможет закрыть архив. Однако может потребоваться выгрузка уведомлений
о реализации маркированного товара, если ФН был зарегистрирован с соответствующими параметрами.

4. Если закрытие архива состоялось, приложение предложит заново открыть порт и прочитать статус ФН. Нажмите кнопку `Да`.

5. Приложение попытается отправить документы (и уведомления для ФФД 1.2) ОФД, автоматически определив адрес по ИНН ОФД из последней
регистрации. Рекомендуется дождаться окончания операции, даже если известно об окончании тарифа.

6. Наконец, будет предложено перейти в режим прямого чтения, чтобы отобразить документ закрытия архива. Нажмите кнопку `Да`.
    - Если приложение сообщит об ошибке, связанной с обновлением таймаута обращения к ФН, повторите запрос, нажав кнопку `Запросить`.

7. Документ закрытия архива отобразится в окне приложения. Вы можете сохранить его в файл или отправить на печать, используя
соответствующие кнопки на вкладке **`Прямое чтение ФН`** (вы будете направлены на неё автоматически).
    - В зависимости от необходимой детализации, вы можете включить или выключить добавление статуса ФН к сохраняемому /
распечатываемому тексту документа.

---



## Запрос документа из памяти ФН

1. На вкладке **`Прямое чтение ФН`** нажмите кнопку `Включить`. Программа автоматически запросит первый документ из архива.
    - При необходимости измените уровень детализации чтения, выбрав вариант *`только основные данные`* (фискальная часть),
*`основные и текстовые данные`* (фискальная часть + известные TLV-теги) или *`все доступные данные`* (фискальная часть + все TLV-теги).

2. Укажите номер требуемого документа в поле, опираясь на отображаемый рядом диапазон доступных номеров.

3. Нажмите кнопку `Запросить` или клавишу `Enter`. В поле статуса будет отображено содержимое документа.
    - Если приложение сообщит об ошибке, связанной с обновлением таймаута обращения к ФН, повторите запрос, нажав кнопку `Запросить`.
    - В этой же вкладке доступны функции сохранения в файл и отправки на печать для содержимого запрошенного документа.

4. Документы могут запрашиваться в любом порядке и количестве последовательным изменением номера и нажатием кнопки `Запросить`.

5. Перемещение на любую другую вкладку выключает прямое чтение и возвращает приложение в обычный режим работы.

---



## Запрос итогов смены из памяти ФН

Если требуется получить итоги смены по дате без полного считывания ФН, потребуются следующие действия:

1. На вкладке **`Статус и счётчики`** укажите дату, которая в наибольшей степени соответствует требуемой смене.

2. Укажите вариант детализации: *`Сменные итоги`* или *`Контрольная лента`*.

3. Укажите, требуется ли отображать ненулевые суммовые счётчики.

4. Нажмите кнопку `Извлечь смену из ФН`.
    - Приложение определяет границы смены и выполняет расчёт её итогов, которые затем можно сохранить или распечатать.
    - Если по указанной дате обнаруживается несколько смен, отображаются все затронутые смены.
    - Если открытие или закрытие смены выполнено другой датой, модуль выполнит дочитывание документов до полной смены.
